<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='1em' font-size='80'>ğŸ’»</text></svg>" type="image/svg+xml">
    <title>ä»£ç æµè§ˆ</title>
    <!-- Prism.js è¯­æ³•é«˜äº® - ä»æœ¬åœ° assets åŠ è½½ -->
    <link href="/assets/prism-tomorrow.min.css" rel="stylesheet" onerror="this.onerror=null; console.warn('Failed to load Prism CSS');" />
    <script>
        // æ ‡è®° Prism æ˜¯å¦åŠ è½½æˆåŠŸ
        window.PrismLoaded = false;
        window.PrismLanguagesLoaded = false;
        
        // åœ¨ core åŠ è½½å®Œæˆåï¼ŒæŒ‰é¡ºåºåŠ è½½è¯­è¨€æ’ä»¶
        // åŠ è½½é¡ºåºï¼šcore -> clike (åˆå§‹åŒ–) -> c -> cpp -> pythonï¼ˆC++ ä¾èµ– C è¯­è¨€æ’ä»¶ï¼ŒC ä¾èµ– clikeï¼‰
        function loadPrismLanguages() {
            // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿ Prism core å®Œå…¨åˆå§‹åŒ–
            setTimeout(function() {
                if (typeof Prism === 'undefined' || !Prism.languages) {
                    console.warn('Prism core not fully initialized');
                    window.PrismLoaded = false;
                    loadPythonOnly();
                    return;
                }
                window.PrismLoaded = true;
                
                // åˆå§‹åŒ– clike è¯­è¨€ï¼ˆC è¯­è¨€æ’ä»¶ä¾èµ–å®ƒï¼‰
                // å¦‚æœ clike ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ clike è¯­è¨€å®šä¹‰
                if (!Prism.languages.clike) {
                    Prism.languages.clike = {
                        'comment': {
                            pattern: /\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,
                            greedy: true
                        },
                        'string': {
                            pattern: /"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,
                            greedy: true
                        },
                        'class-name': {
                            pattern: /\b[A-Z]\w*/,
                            lookbehind: false
                        },
                        'keyword': /\b(?:if|else|for|while|do|break|continue|return|switch|case|default|goto|typedef|struct|enum|union|class|namespace|using|public|private|protected|virtual|static|const|volatile|extern|inline|template|typename|auto|decltype|sizeof|new|delete|throw|try|catch|finally|this|true|false|nullptr|null)\b/,
                        'boolean': /\b(?:true|false)\b/,
                        'function': /\b[a-z_]\w*(?=\s*\()/i,
                        'number': /(?:\b0x[\da-f]+|(?:\b\d+\.?\d*|\B\.\d+)(?:e[+-]?\d+)?)[ful]*/i,
                        'operator': />>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/,
                        'punctuation': /[{}[\];(),.:]/
                    };
                }
                
                // å…ˆåŠ è½½ C è¯­è¨€æ’ä»¶ï¼ˆC++ ä¾èµ–å®ƒï¼‰
                var cScript = document.createElement('script');
                cScript.src = '/assets/prism-c.min.js';
                cScript.onload = function() {
                    // C åŠ è½½å®ŒæˆååŠ è½½ C++
                    var cppScript = document.createElement('script');
                    cppScript.src = '/assets/prism-cpp.min.js';
                    cppScript.onload = function() {
                        // C++ åŠ è½½å®ŒæˆååŠ è½½ Python
                        var pythonScript = document.createElement('script');
                        pythonScript.src = '/assets/prism-python.min.js';
                        pythonScript.onload = function() {
                            window.PrismLanguagesLoaded = true;
                        };
                        pythonScript.onerror = function() {
                            console.warn('Failed to load Prism Python');
                            this.onerror = null;
                            window.PrismLanguagesLoaded = true;
                        };
                        document.head.appendChild(pythonScript);
                    };
                    cppScript.onerror = function() {
                        console.warn('Failed to load Prism C++');
                        this.onerror = null;
                        loadPythonOnly();
                    };
                    document.head.appendChild(cppScript);
                };
                cScript.onerror = function() {
                    console.warn('Failed to load Prism C');
                    this.onerror = null;
                    // å³ä½¿ C åŠ è½½å¤±è´¥ï¼Œä¹Ÿå°è¯•åŠ è½½ C++ å’Œ Python
                    var cppScript = document.createElement('script');
                    cppScript.src = '/assets/prism-cpp.min.js';
                    cppScript.onload = function() {
                        loadPythonOnly();
                    };
                    cppScript.onerror = function() {
                        console.warn('Failed to load Prism C++');
                        this.onerror = null;
                        loadPythonOnly();
                    };
                    document.head.appendChild(cppScript);
                };
                document.head.appendChild(cScript);
            }, 100);
        }
        
        // åªåŠ è½½ Pythonï¼ˆå½“å…¶ä»–æ’ä»¶åŠ è½½å¤±è´¥æ—¶ï¼‰
        function loadPythonOnly() {
            var pythonScript = document.createElement('script');
            pythonScript.src = '/assets/prism-python.min.js';
            pythonScript.onload = function() {
                window.PrismLanguagesLoaded = true;
            };
            pythonScript.onerror = function() {
                console.warn('Failed to load Prism Python');
                this.onerror = null;
                window.PrismLanguagesLoaded = true;
            };
            document.head.appendChild(pythonScript);
        }
    </script>
    <script src="/assets/prism-core.min.js" onload="loadPrismLanguages()" onerror="window.PrismLoadFailed=true; this.onerror=null; console.warn('Failed to load Prism core'); window.PrismLoaded=false;"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background-color: #0d1117;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 12px;
        }
        .sidebar {
            width: 300px;
            min-width: 150px;
            max-width: 50%;
            background-color: #252526;
            border-radius: 12px;
            overflow-y: auto;
            overflow-x: hidden;
            flex-shrink: 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }
        .resizer {
            width: 4px;
            background-color: transparent;
            cursor: col-resize;
            flex-shrink: 0;
            position: relative;
            user-select: none;
            transition: background-color 0.2s;
        }
        .resizer:hover {
            background-color: #0e639c;
        }
        .resizer.dragging {
            background-color: #0e639c;
        }
        .code-viewer {
            flex: 1;
            min-width: 200px;
            display: flex;
            flex-direction: column;
            background-color: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .code-header {
            background-color: #2d2d30;
            padding: 10px 20px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            border-radius: 12px 12px 0 0;
        }
        .menu-btn {
            display: none;
            background: none;
            border: none;
            color: #cccccc;
            font-size: 20px;
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 10px;
            transition: color 0.2s;
        }
        .menu-btn:hover {
            color: #ffffff;
        }
        .code-title {
            color: #cccccc;
            font-size: 14px;
            font-weight: normal;
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
            gap: 8px;
        }
        .code-title-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            min-width: 0;
        }
        .close-btn {
            display: none;
            background-color: #c53030;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            transition: background-color 0.2s;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover {
            background-color: #e53e3e;
        }
        .close-btn:active {
            background-color: #9b2c2c;
        }
        .copy-btn {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            transition: background-color 0.2s;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .copy-btn:hover {
            background-color: #1177bb;
        }
        .copy-btn:active {
            background-color: #0a4d73;
        }
        .copy-btn.copied {
            background-color: #0e7c0e;
        }
        .font-size-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
        }
        .font-size-btn {
            background-color: #3e3e42;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            transition: background-color 0.2s;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .font-size-btn:hover {
            background-color: #4e4e52;
        }
        .font-size-btn:active {
            background-color: #2e2e32;
        }
        .font-size-btn:disabled {
            background-color: #2a2a2a;
            color: #666;
            cursor: not-allowed;
        }
        .refresh-btn {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            transition: background-color 0.2s;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
        }
        .refresh-btn:hover {
            background-color: #1177bb;
        }
        .refresh-btn:active {
            background-color: #0a4d73;
        }
        .refresh-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .refresh-btn .refresh-icon {
            display: inline-block;
            transition: transform 0.2s;
        }
        .refresh-btn.refreshing .refresh-icon {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* ä¸‹æ‹‰èœå•æ ·å¼ */
        .dropdown-menu {
            position: relative;
            display: none;
        }
        .dropdown-btn {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            transition: background-color 0.2s;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        .dropdown-btn:hover {
            background-color: #1177bb;
        }
        .dropdown-btn:active {
            background-color: #0a4d73;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 4px;
            background-color: #2d2d30;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            min-width: 150px;
            z-index: 1000;
            overflow: hidden;
        }
        .dropdown-content.show {
            display: block;
        }
        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            color: #cccccc;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
            font-family: inherit;
        }
        .dropdown-item:hover {
            background-color: #37373d;
        }
        .dropdown-item:active {
            background-color: #3e3e42;
        }
        .dropdown-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .dropdown-item.disabled:hover {
            background-color: transparent;
        }
        .dropdown-divider {
            height: 1px;
            background-color: #3e3e42;
            margin: 4px 0;
        }
        body.light-theme .dropdown-content {
            background-color: #f8f8f8;
            border: 1px solid #c0c0c0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        body.light-theme .dropdown-item {
            color: #333333;
        }
        body.light-theme .dropdown-item:hover {
            background-color: #e8e8e8;
        }
        body.light-theme .dropdown-item:active {
            background-color: #d0d0d0;
        }
        body.light-theme .dropdown-divider {
            background-color: #c0c0c0;
        }
        body.light-theme .dropdown-btn {
            background-color: #0e639c;
        }
        body.light-theme .dropdown-btn:hover {
            background-color: #1177bb;
        }
        /* ä¸»é¢˜åˆ‡æ¢æ»‘å— */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3e3e42;
            transition: 0.3s;
            border-radius: 24px;
        }
        .theme-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        .theme-switch input:checked + .theme-slider {
            background-color: #0e639c;
        }
        .theme-switch input:checked + .theme-slider:before {
            transform: translateX(20px);
        }
        .theme-switch input:focus + .theme-slider {
            box-shadow: 0 0 1px #0e639c;
        }
        .code-content {
            flex: 1;
            overflow: auto;
            padding: 0;
            position: relative;
        }
        .code-wrapper {
            display: flex;
            min-height: 100%;
        }
        .line-numbers {
            background-color: #252526;
            color: #858585;
            padding: 20px 10px 20px 20px;
            text-align: right;
            user-select: none;
            flex-shrink: 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            border-right: 1px solid #3e3e42;
        }
        .line-number {
            display: block;
            padding-right: 15px;
            min-height: 1.6em;
        }
        .code-content pre {
            margin: 0;
            padding: 20px;
            background: transparent;
            border: none;
            font-size: 14px;
            line-height: 1.6;
            flex: 1;
            overflow: visible;
        }
        .code-content code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }
        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #858585;
            font-size: 14px;
        }
        /* å›¾ç‰‡é¢„è§ˆæ ·å¼ */
        .image-preview-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            overflow: auto;
            background-color: #1e1e1e;
        }
        .preview-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        body.light-theme .image-preview-container {
            background-color: #ffffff;
        }
        /* ç›®å½•æ ‘æ ·å¼ */
        .file-tree {
            padding: 12px 8px;
        }
        .tree-item {
            padding: 0;
            cursor: pointer;
            user-select: none;
            display: flex;
            flex-direction: column;
            font-size: 13px;
            transition: background-color 0.1s;
            position: relative;
            line-height: 22px;
            min-height: 22px;
        }
        .tree-item-row {
            display: flex;
            align-items: center;
            min-height: 22px;
        }
        .tree-item-row:hover {
            background-color: #2a2d2e;
        }
        .tree-item.active > .tree-item-row {
            background-color: #37373d;
        }
        .tree-item-wrapper {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
            padding: 0 4px 0 0;
        }
        .tree-item-indent {
            flex-shrink: 0;
            display: flex;
            align-items: center;
        }
        .tree-item-expander {
            width: 16px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 2px;
            color: #858585;
            font-size: 10px;
        }
        .tree-item[data-type="dir"] .tree-item-expander::before {
            content: '>';
            transition: transform 0.15s ease;
            display: inline-block;
        }
        .tree-item[data-type="dir"].expanded > .tree-item-row > .tree-item-expander::before {
            transform: rotate(90deg);
        }
        .tree-item[data-type="file"] .tree-item-expander {
            width: 18px;
        }
        .tree-item[data-type="file"] .tree-item-expander::before {
            content: '';
        }
        .tree-item-icon {
            margin-right: 6px;
            width: 16px;
            text-align: center;
            font-size: 14px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tree-item-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #cccccc;
        }
        .tree-item-children {
            display: none;
        }
        .tree-item.expanded > .tree-item-children {
            display: block;
        }
        /* æ–‡ä»¶å¤¹å›¾æ ‡ */
        .tree-item[data-type="dir"] .tree-item-icon::before {
            content: 'ğŸ“';
            font-size: 14px;
        }
        .tree-item[data-type="dir"].expanded .tree-item-icon::before {
            content: 'ğŸ“‚';
        }
        /* æ–‡ä»¶ç±»å‹å›¾æ ‡ - ç¡®ä¿æƒé‡è¶³å¤Ÿï¼Œä¸ä¼šè¢«æ–‡ä»¶å¤¹æ ·å¼è¦†ç›– */
        .tree-item[data-type="file"] .tree-item-icon::before {
            content: 'ğŸ“„' !important;
            font-size: 14px;
        }
        /* å›¾ç‰‡æ–‡ä»¶å›¾æ ‡ */
        .tree-item[data-type="file"][data-ext="jpg"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="jpeg"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="png"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="gif"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="bmp"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="webp"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="svg"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="ico"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="tiff"] .tree-item-icon::before,
        .tree-item[data-type="file"][data-ext="tif"] .tree-item-icon::before {
            content: 'ğŸ–¼ï¸' !important;
            font-size: 14px;
        }
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }
        ::-webkit-scrollbar-thumb {
            background: #424242;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4e4e4e;
        }
        .sidebar::-webkit-scrollbar-track {
            background: #252526;
        }
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #858585;
            font-size: 14px;
        }
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        /* æµ…è‰²ä¸»é¢˜ */
        body.light-theme {
            background-color: #f5f5f5;
            color: #333333;
        }
        body.light-theme .main-container {
            gap: 12px;
        }
        body.light-theme .sidebar {
            background-color: #ffffff;
            border: 1px solid #c0c0c0;
            box-shadow: none;
        }
        body.light-theme .code-viewer {
            background-color: #ffffff;
            border: 1px solid #c0c0c0;
            box-shadow: none;
        }
        body.light-theme .code-header {
            background-color: #f8f8f8;
            border-bottom: 1px solid #c0c0c0;
        }
        body.light-theme .code-title {
            color: #333333;
        }
        body.light-theme .code-title-text {
            color: #333333;
        }
        body.light-theme .menu-btn {
            color: #666666;
        }
        body.light-theme .menu-btn:hover {
            color: #333333;
        }
        body.light-theme .code-content {
            background-color: #ffffff;
        }
        body.light-theme .line-numbers {
            background-color: #f8f8f8;
            color: #666666;
            border-right: 1px solid #c0c0c0;
        }
        body.light-theme .tree-item-row:hover {
            background-color: #f0f0f0;
        }
        body.light-theme .tree-item.active > .tree-item-row {
            background-color: #e8e8e8;
        }
        body.light-theme .tree-item-name {
            color: #333333;
        }
        body.light-theme .empty-state {
            color: #999999;
        }
        body.light-theme .loading {
            color: #999999;
        }
        body.light-theme .copy-btn {
            background-color: #0e639c;
        }
        body.light-theme .copy-btn:hover {
            background-color: #1177bb;
        }
        body.light-theme .font-size-btn {
            background-color: #e0e0e0;
            color: #333333;
        }
        body.light-theme .font-size-btn:hover {
            background-color: #d0d0d0;
        }
        body.light-theme .font-size-btn:disabled {
            background-color: #f0f0f0;
            color: #999999;
        }
        body.light-theme .refresh-btn {
            background-color: #0e639c;
        }
        body.light-theme .refresh-btn:hover {
            background-color: #1177bb;
        }
        body.light-theme .close-btn {
            background-color: #c53030;
        }
        body.light-theme .close-btn:hover {
            background-color: #e53e3e;
        }
        body.light-theme .resizer:hover {
            background-color: #0e639c;
        }
        body.light-theme .sidebar-overlay {
            background-color: rgba(0, 0, 0, 0.3);
        }
        body.light-theme ::-webkit-scrollbar-track {
            background: #f5f5f5;
        }
        body.light-theme .sidebar::-webkit-scrollbar-track {
            background: #ffffff;
        }
        body.light-theme .theme-slider {
            background-color: #d0d0d0;
        }
        body.light-theme .theme-switch input:checked + .theme-slider {
            background-color: #0e639c;
        }
        /* æµ…è‰²ä¸»é¢˜ä¸‹çš„ä»£ç é«˜äº®æ ·å¼ */
        body.light-theme .code-content pre[class*="language-"],
        body.light-theme .code-content code[class*="language-"] {
            color: #24292e;
            background: #ffffff;
        }
        body.light-theme .code-content pre {
            background: #ffffff;
        }
        body.light-theme .code-content code {
            color: #24292e;
        }
        body.light-theme .code-content .token.comment,
        body.light-theme .code-content .token.prolog,
        body.light-theme .code-content .token.doctype,
        body.light-theme .code-content .token.cdata {
            color: #6a737d;
            font-style: italic;
        }
        body.light-theme .code-content .token.punctuation {
            color: #24292e;
        }
        body.light-theme .code-content .token.property,
        body.light-theme .code-content .token.tag,
        body.light-theme .code-content .token.boolean,
        body.light-theme .code-content .token.number,
        body.light-theme .code-content .token.constant,
        body.light-theme .code-content .token.symbol,
        body.light-theme .code-content .token.deleted {
            color: #d73a49;
        }
        body.light-theme .code-content .token.selector,
        body.light-theme .code-content .token.attr-name,
        body.light-theme .code-content .token.string,
        body.light-theme .code-content .token.char,
        body.light-theme .code-content .token.builtin,
        body.light-theme .code-content .token.inserted {
            color: #032f62;
        }
        body.light-theme .code-content .token.operator,
        body.light-theme .code-content .token.entity,
        body.light-theme .code-content .token.url,
        body.light-theme .code-content .language-css .token.string,
        body.light-theme .code-content .style .token.string {
            color: #a626a4;
        }
        body.light-theme .code-content .token.atrule,
        body.light-theme .code-content .token.attr-value,
        body.light-theme .code-content .token.keyword {
            color: #d73a49;
        }
        body.light-theme .code-content .token.function,
        body.light-theme .code-content .token.class-name {
            color: #6f42c1;
        }
        body.light-theme .code-content .token.regex,
        body.light-theme .code-content .token.important,
        body.light-theme .code-content .token.variable {
            color: #e36209;
        }
        body.light-theme .code-content .token.important,
        body.light-theme .code-content .token.bold {
            font-weight: bold;
        }
        body.light-theme .code-content .token.italic {
            font-style: italic;
        }
        body.light-theme .code-content .token.entity {
            cursor: help;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            .main-container {
                flex-direction: row;
                gap: 0;
                position: relative;
            }
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                width: 280px;
                max-width: 85%;
                height: 100vh;
                border-radius: 0;
                z-index: 999;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            .code-viewer {
                width: 100%;
                border-radius: 0;
                box-shadow: none;
            }
            .code-header {
                border-radius: 0;
            }
            .menu-btn {
                display: block;
            }
            .resizer {
                display: none;
            }
            /* ç§»åŠ¨ç«¯ï¼šéšè—åŸå§‹æŒ‰é’®ï¼Œæ˜¾ç¤ºä¸‹æ‹‰èœå• */
            .font-size-controls {
                display: none !important;
            }
            .copy-btn {
                display: none !important;
            }
            .dropdown-menu {
                display: block;
            }
            /* æµ…è‰²ä¸»é¢˜åœ¨ç§»åŠ¨ç«¯çš„æ ·å¼ */
            body.light-theme .sidebar {
                box-shadow: none;
                border-right: 2px solid #c0c0c0;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <div class="file-tree" id="fileTree">
                <div class="loading">åŠ è½½ç›®å½•ç»“æ„</div>
            </div>
        </div>
        <div class="resizer" id="resizer"></div>
        <div class="code-viewer">
            <div class="code-header">
                <div class="code-title">
                    <button class="menu-btn" id="menuBtn">â˜°</button>
                    <span class="code-title-text" id="codeTitle">é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶æŸ¥çœ‹ä»£ç </span>
                </div>
                <div style="display: flex; align-items: center;">
                    <div class="font-size-controls" id="fontSizeControls" style="display: none;">
                        <button class="close-btn" id="closeBtn" title="å…³é—­æ–‡ä»¶">Ã—</button>
                        <button class="font-size-btn" id="fontSizeDecrease" title="å‡å°å­—ä½“">âˆ’</button>
                        <button class="font-size-btn" id="fontSizeIncrease" title="å¢å¤§å­—ä½“">+</button>
                    </div>
                    <!-- ç§»åŠ¨ç«¯ä¸‹æ‹‰èœå• -->
                    <div class="dropdown-menu" id="dropdownMenu">
                        <button class="dropdown-btn" id="dropdownBtn" title="æ›´å¤šæ“ä½œ">â‹®</button>
                        <div class="dropdown-content" id="dropdownContent">
                            <button class="dropdown-item" id="dropdownClose" title="å…³é—­æ–‡ä»¶">å…³é—­æ–‡ä»¶</button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item" id="dropdownCopy" title="å¤åˆ¶ä»£ç ">å¤åˆ¶ä»£ç </button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item" id="dropdownFontDecrease" title="å‡å°å­—ä½“">å‡å°å­—ä½“</button>
                            <button class="dropdown-item" id="dropdownFontIncrease" title="å¢å¤§å­—ä½“">å¢å¤§å­—ä½“</button>
                        </div>
                    </div>
                    <button class="refresh-btn" id="refreshBtn" title="åˆ·æ–°å†…å®¹"><span class="refresh-icon">âŸ³</span></button>
                    <button class="copy-btn" id="copyBtn" style="display: none;">copy</button>
                    <div class="theme-toggle">
                        <label class="theme-switch">
                            <input type="checkbox" id="themeToggle">
                            <span class="theme-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="code-content" id="codeContent">
                <div class="empty-state">è¯·ä»å·¦ä¾§é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹ä»£ç </div>
            </div>
        </div>
    </div>

    <script>
        let fileTree = [];
        let currentFile = null;
        
        // å­—ä½“å¤§å°æ§åˆ¶
        let currentFontSize = parseInt(localStorage.getItem('codeFontSize')) || 14;
        const minFontSize = 10;
        const maxFontSize = 24;
        const fontSizeStep = 2;
        
        // åº”ç”¨å­—ä½“å¤§å°
        function applyFontSize(size) {
            // é™åˆ¶å­—ä½“å¤§å°èŒƒå›´
            size = Math.max(minFontSize, Math.min(maxFontSize, size));
            currentFontSize = size;
            
            // åº”ç”¨åˆ°ä»£ç å’Œè¡Œå·
            const codeContent = document.getElementById('codeContent');
            const preElements = codeContent.querySelectorAll('pre');
            const lineNumbersElements = codeContent.querySelectorAll('.line-numbers');
            
            preElements.forEach(el => {
                el.style.fontSize = size + 'px';
            });
            
            lineNumbersElements.forEach(el => {
                el.style.fontSize = size + 'px';
            });
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('codeFontSize', size.toString());
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€ï¼ˆæ¡Œé¢ç«¯ï¼‰
            const fontSizeDecrease = document.getElementById('fontSizeDecrease');
            const fontSizeIncrease = document.getElementById('fontSizeIncrease');
            if (fontSizeDecrease) {
                fontSizeDecrease.disabled = (size <= minFontSize);
            }
            if (fontSizeIncrease) {
                fontSizeIncrease.disabled = (size >= maxFontSize);
            }
            
            // æ›´æ–°ä¸‹æ‹‰èœå•ä¸­çš„å­—ä½“æŒ‰é’®çŠ¶æ€ï¼ˆç§»åŠ¨ç«¯ï¼‰
            const dropdownFontDecrease = document.getElementById('dropdownFontDecrease');
            const dropdownFontIncrease = document.getElementById('dropdownFontIncrease');
            if (dropdownFontDecrease) {
                dropdownFontDecrease.disabled = (size <= minFontSize);
                dropdownFontDecrease.classList.toggle('disabled', size <= minFontSize);
            }
            if (dropdownFontIncrease) {
                dropdownFontIncrease.disabled = (size >= maxFontSize);
                dropdownFontIncrease.classList.toggle('disabled', size >= maxFontSize);
            }
        }

        // è·å–ç›®å½•æ ‘
        async function loadFileTree() {
            try {
                const response = await fetch('/api/tree');
                const data = await response.json();
                if (data.tree) {
                    fileTree = data.tree;
                    renderFileTree();
                }
            } catch (error) {
                console.error('åŠ è½½ç›®å½•æ ‘å¤±è´¥:', error);
                document.getElementById('fileTree').innerHTML = '<div style="padding: 20px; color: #e74c3c;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
            }
        }

        // æ¸²æŸ“ç›®å½•æ ‘
        function renderFileTree() {
            const container = document.getElementById('fileTree');
            container.innerHTML = '';
            
            function renderItem(item, level = 0, isLast = false, parentPath = []) {
                const div = document.createElement('div');
                div.className = 'tree-item';
                div.setAttribute('data-type', item.is_dir ? 'dir' : 'file');
                div.setAttribute('data-path', item.path);
                
                // è·å–æ–‡ä»¶æ‰©å±•å
                if (!item.is_dir) {
                    const ext = item.name.split('.').pop().toLowerCase();
                    div.setAttribute('data-ext', ext);
                }
                
                // é»˜è®¤ä¸å±•å¼€ï¼Œç”¨æˆ·éœ€è¦ç‚¹å‡»æ‰èƒ½å±•å¼€
                
                // åˆ›å»ºè¡Œå®¹å™¨ï¼ˆåŒ…å«ç¼©è¿›ã€å±•å¼€å™¨ã€å›¾æ ‡å’Œåç§°ï¼‰
                const row = document.createElement('div');
                row.className = 'tree-item-row';
                
                // åˆ›å»ºç¼©è¿›ï¼ˆæ¯çº§ç¼©è¿›16pxï¼‰
                const indentDiv = document.createElement('div');
                indentDiv.className = 'tree-item-indent';
                indentDiv.style.width = `${level * 16}px`;
                indentDiv.style.minWidth = `${level * 16}px`;
                
                // åˆ›å»ºå±•å¼€/æŠ˜å æŒ‡ç¤ºå™¨ï¼ˆä»…æ–‡ä»¶å¤¹æ˜¾ç¤ºï¼‰
                const expander = document.createElement('div');
                expander.className = 'tree-item-expander';
                
                // åˆ›å»ºå†…å®¹åŒ…è£…å™¨
                const wrapper = document.createElement('div');
                wrapper.className = 'tree-item-wrapper';
                wrapper.innerHTML = `
                    <span class="tree-item-icon"></span>
                    <span class="tree-item-name">${escapeHtml(item.name)}</span>
                `;
                
                row.appendChild(indentDiv);
                row.appendChild(expander);
                row.appendChild(wrapper);
                div.appendChild(row);
                
                // å¤„ç†å­é¡¹
                if (item.is_dir && item.children && item.children.length > 0) {
                    const childrenDiv = document.createElement('div');
                    childrenDiv.className = 'tree-item-children';
                    item.children.forEach((child, index) => {
                        const isLastChild = index === item.children.length - 1;
                        childrenDiv.appendChild(renderItem(child, level + 1, isLastChild, [...parentPath, item.path]));
                    });
                    div.appendChild(childrenDiv);
                }
                
                div.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (item.is_dir) {
                        div.classList.toggle('expanded');
                    } else {
                        loadFile(item.path);
                        // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                        document.querySelectorAll('.tree-item').forEach(el => {
                            el.classList.remove('active');
                        });
                        div.classList.add('active');
                    }
                });
                
                return div;
            }
            
            fileTree.forEach((item, index) => {
                const isLast = index === fileTree.length - 1;
                container.appendChild(renderItem(item, 0, isLast, []));
            });
        }

        // åŠ è½½æ–‡ä»¶å†…å®¹
        async function loadFile(path) {
            currentFile = path;
            const codeContent = document.getElementById('codeContent');
            const codeTitle = document.getElementById('codeTitle');
            const copyBtn = document.getElementById('copyBtn');
            const refreshBtn = document.getElementById('refreshBtn');
            
            // æ›´æ–°åˆ·æ–°æŒ‰é’®æç¤º
            if (refreshBtn) {
                refreshBtn.title = 'åˆ·æ–°å½“å‰æ–‡ä»¶: ' + path.split('/').pop();
            }
            
            codeContent.innerHTML = '<div class="loading">åŠ è½½æ–‡ä»¶</div>';
            copyBtn.style.display = 'none';
            
            // å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶ï¼Œå¦‚æœæ˜¯å›¾ç‰‡ï¼Œç›´æ¥æ˜¾ç¤ºï¼Œä¸éœ€è¦è°ƒç”¨API
            if (isImageFile(path)) {
                const fileName = path.split('/').pop();
                codeTitle.textContent = fileName || path;
                document.getElementById('closeBtn').style.display = 'block';
                updateDropdownMenuVisibility();
                
                // æ˜¾ç¤ºå›¾ç‰‡
                const imageUrl = '/' + encodeURIComponent(path);
                codeContent.innerHTML = `
                    <div class="image-preview-container">
                        <img src="${imageUrl}" alt="${escapeHtml(fileName || path)}" class="preview-image" 
                             onerror="this.parentElement.innerHTML='<div class=\\'empty-state\\'>å›¾ç‰‡åŠ è½½å¤±è´¥</div>';" />
                    </div>
                `;
                // å›¾ç‰‡ä¸éœ€è¦å¤åˆ¶åŠŸèƒ½ï¼Œéšè—å¤åˆ¶æŒ‰é’®
                copyBtn.style.display = 'none';
                // å›¾ç‰‡ä¸éœ€è¦å­—ä½“å¤§å°æ§åˆ¶ï¼Œéšè—å­—ä½“æ§åˆ¶
                document.getElementById('fontSizeControls').style.display = 'none';
                // æ¸…é™¤åŸå§‹å†…å®¹æ•°æ®
                codeContent.dataset.rawContent = '';
                // ç¦ç”¨ä¸‹æ‹‰èœå•ä¸­çš„å¤åˆ¶æŒ‰é’®
                const dropdownCopy = document.getElementById('dropdownCopy');
                if (dropdownCopy) {
                    dropdownCopy.disabled = true;
                    dropdownCopy.classList.add('disabled');
                }
                return;
            }
            
            // éå›¾ç‰‡æ–‡ä»¶ï¼Œé€šè¿‡APIè·å–å†…å®¹
            try {
                const response = await fetch('/' + encodeURIComponent(path));
                if (!response.ok) {
                    throw new Error('æ–‡ä»¶åŠ è½½å¤±è´¥');
                }
                
                const data = await response.json();
                
                if (data.error) {
                    codeContent.innerHTML = `<div class="empty-state">${escapeHtml(data.error)}</div>`;
                    document.getElementById('closeBtn').style.display = 'none';
                    return;
                }
                
                codeTitle.textContent = data.name || path;
                copyBtn.style.display = 'block';
                document.getElementById('fontSizeControls').style.display = 'flex';
                document.getElementById('closeBtn').style.display = 'block';
                updateDropdownMenuVisibility();
                
                // éå›¾ç‰‡æ–‡ä»¶ï¼Œå¯ç”¨å¤åˆ¶æŒ‰é’®
                const dropdownCopy = document.getElementById('dropdownCopy');
                if (dropdownCopy) {
                    dropdownCopy.disabled = false;
                    dropdownCopy.classList.remove('disabled');
                }
                
                // è·å–æ–‡ä»¶æ‰©å±•åä»¥ç¡®å®šè¯­è¨€
                const ext = path.split('.').pop().toLowerCase();
                let language = getLanguageFromExt(ext);
                
                // è®¡ç®—è¡Œæ•°
                const lines = data.content.split('\n');
                const lineCount = lines.length;
                
                // ç”Ÿæˆè¡Œå·
                let lineNumbersHtml = '';
                for (let i = 1; i <= lineCount; i++) {
                    lineNumbersHtml += `<span class="line-number">${i}</span>\n`;
                }
                
                // ä½¿ç”¨ Prism.js é«˜äº®ä»£ç ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                let highlighted;
                let codeClass = '';
                
                // ç­‰å¾… Prism å’Œè¯­è¨€æ’ä»¶åŠ è½½å®Œæˆï¼ˆæœ€å¤šç­‰å¾… 2 ç§’ï¼‰
                const checkPrismAndHighlight = () => {
                    if (window.PrismLoaded && typeof Prism !== 'undefined' && Prism.languages) {
                        // æ£€æŸ¥è¯­è¨€æ˜¯å¦å¯ç”¨
                        let actualLanguage = null;
                        if (Prism.languages[language]) {
                            actualLanguage = language;
                        }
                        
                        if (actualLanguage && Prism.languages[actualLanguage]) {
                            try {
                                highlighted = Prism.highlight(data.content, Prism.languages[actualLanguage], actualLanguage);
                                codeClass = `language-${actualLanguage}`;
                            } catch (e) {
                                console.warn('Prism highlight failed:', e);
                                // é™çº§ï¼šè½¬ä¹‰ HTML å¹¶æ˜¾ç¤ºçº¯æ–‡æœ¬
                                highlighted = escapeHtml(data.content);
                            }
                        } else {
                            // è¯­è¨€ä¸æ”¯æŒï¼Œè½¬ä¹‰ HTML å¹¶æ˜¾ç¤ºçº¯æ–‡æœ¬
                            highlighted = escapeHtml(data.content);
                        }
                        
                        // åˆ›å»ºå¸¦è¡Œå·çš„ä»£ç æ˜¾ç¤ºç»“æ„
                        codeContent.innerHTML = `
                            <div class="code-wrapper">
                                <div class="line-numbers">${lineNumbersHtml}</div>
                                <pre><code${codeClass ? ' class="' + codeClass + '"' : ''}>${highlighted}</code></pre>
                            </div>
                        `;
                        
                        // åº”ç”¨ä¿å­˜çš„å­—ä½“å¤§å°
                        setTimeout(() => {
                            applyFontSize(currentFontSize);
                        }, 50);
                    } else {
                        // Prism æœªåŠ è½½ï¼Œè½¬ä¹‰ HTML å¹¶æ˜¾ç¤ºçº¯æ–‡æœ¬
                        highlighted = escapeHtml(data.content);
                        
                        // åˆ›å»ºå¸¦è¡Œå·çš„ä»£ç æ˜¾ç¤ºç»“æ„
                        codeContent.innerHTML = `
                            <div class="code-wrapper">
                                <div class="line-numbers">${lineNumbersHtml}</div>
                                <pre><code>${highlighted}</code></pre>
                            </div>
                        `;
                        
                        // åº”ç”¨ä¿å­˜çš„å­—ä½“å¤§å°
                        setTimeout(() => {
                            applyFontSize(currentFontSize);
                        }, 50);
                    }
                };
                
                // å¦‚æœ Prism å·²åŠ è½½ï¼Œç›´æ¥å¤„ç†ï¼›å¦åˆ™ç­‰å¾…ä¸€ä¸‹
                if (window.PrismLoaded && typeof Prism !== 'undefined') {
                    checkPrismAndHighlight();
                } else {
                    // ç­‰å¾…æœ€å¤š 2 ç§’è®© Prism åŠ è½½
                    let attempts = 0;
                    const maxAttempts = 20; // 2ç§’ = 20 * 100ms
                    const checkInterval = setInterval(() => {
                        attempts++;
                        if (window.PrismLoaded && typeof Prism !== 'undefined') {
                            clearInterval(checkInterval);
                            checkPrismAndHighlight();
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            // è¶…æ—¶ï¼Œä½¿ç”¨çº¯æ–‡æœ¬æ˜¾ç¤º
                            highlighted = escapeHtml(data.content);
                            codeContent.innerHTML = `
                                <div class="code-wrapper">
                                    <div class="line-numbers">${lineNumbersHtml}</div>
                                    <pre><code>${highlighted}</code></pre>
                                </div>
                            `;
                            setTimeout(() => {
                                applyFontSize(currentFontSize);
                            }, 50);
                        }
                    }, 100);
                }
                
                // å¦‚æœ Prism è¿˜æœªåŠ è½½ï¼Œå…ˆæ˜¾ç¤ºçº¯æ–‡æœ¬ï¼ˆç­‰å¾…åŠ è½½å®Œæˆåä¼šæ›´æ–°ï¼‰
                if (!window.PrismLoaded || typeof Prism === 'undefined') {
                    highlighted = escapeHtml(data.content);
                    codeContent.innerHTML = `
                        <div class="code-wrapper">
                            <div class="line-numbers">${lineNumbersHtml}</div>
                            <pre><code>${highlighted}</code></pre>
                        </div>
                    `;
                    setTimeout(() => {
                        applyFontSize(currentFontSize);
                    }, 50);
                }
                
                // å­˜å‚¨åŸå§‹å†…å®¹ç”¨äºå¤åˆ¶
                codeContent.dataset.rawContent = data.content;
                
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶å¤±è´¥:', error);
                codeContent.innerHTML = '<div class="empty-state">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                document.getElementById('closeBtn').style.display = 'none';
            }
        }

        // å…³é—­å½“å‰æ–‡ä»¶
        function closeFile() {
            currentFile = null;
            const codeContent = document.getElementById('codeContent');
            const codeTitle = document.getElementById('codeTitle');
            const copyBtn = document.getElementById('copyBtn');
            const closeBtn = document.getElementById('closeBtn');
            const fontSizeControls = document.getElementById('fontSizeControls');
            const refreshBtn = document.getElementById('refreshBtn');
            
            // æ¢å¤åˆå§‹çŠ¶æ€
            codeContent.innerHTML = '<div class="empty-state">è¯·ä»å·¦ä¾§é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹ä»£ç </div>';
            codeTitle.textContent = 'é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶æŸ¥çœ‹ä»£ç ';
            copyBtn.style.display = 'none';
            closeBtn.style.display = 'none';
            fontSizeControls.style.display = 'none';
            
            // æ¸…é™¤åŸå§‹å†…å®¹æ•°æ®
            codeContent.dataset.rawContent = '';
            
            // é‡ç½®ä¸‹æ‹‰èœå•ä¸­çš„å¤åˆ¶æŒ‰é’®çŠ¶æ€
            const dropdownCopy = document.getElementById('dropdownCopy');
            if (dropdownCopy) {
                dropdownCopy.disabled = false;
                dropdownCopy.classList.remove('disabled');
            }
            
            // æ›´æ–°åˆ·æ–°æŒ‰é’®æç¤º
            if (refreshBtn) {
                refreshBtn.title = 'åˆ·æ–°ç›®å½•æ ‘';
            }
            
            // æ¸…é™¤æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tree-item').forEach(el => {
                el.classList.remove('active');
            });
            
            // æ›´æ–°ä¸‹æ‹‰èœå•æ˜¾ç¤ºçŠ¶æ€
            updateDropdownMenuVisibility();
        }

        // æ ¹æ®æ–‡ä»¶æ‰©å±•åè·å–è¯­è¨€ï¼ˆä»…æ”¯æŒ C++ å’Œ Pythonï¼‰
        // åªæ”¯æŒ cpp å’Œ hpp åç¼€çš„ C++ æ–‡ä»¶
        function getLanguageFromExt(ext) {
            const langMap = {
                'py': 'python',
                'pyw': 'python',
                'cpp': 'cpp',
                'hpp': 'cpp',
            };
            return langMap[ext] || 'text';
        }

        // æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºå›¾ç‰‡
        function isImageFile(filename) {
            const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'ico', 'tiff', 'tif'];
            const ext = filename.split('.').pop().toLowerCase();
            return imageExtensions.includes(ext);
        }

        // å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿çš„é€šç”¨å‡½æ•°
        async function copyToClipboard(text) {
            // ä¼˜å…ˆä½¿ç”¨ Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (error) {
                    // å¦‚æœ Clipboard API å¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ
                    return fallbackCopyToClipboard(text);
                }
            } else {
                // å¦‚æœä¸æ”¯æŒ Clipboard APIï¼Œç›´æ¥ä½¿ç”¨é™çº§æ–¹æ¡ˆ
                return fallbackCopyToClipboard(text);
            }
        }
        
        // é™çº§å¤åˆ¶æ–¹æ¡ˆ
        function fallbackCopyToClipboard(text) {
            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                textarea.style.left = '-9999px';
                document.body.appendChild(textarea);
                textarea.select();
                const success = document.execCommand('copy');
                document.body.removeChild(textarea);
                return success;
            } catch (e) {
                return false;
            }
        }

        // å¤åˆ¶ä»£ç 
        document.getElementById('copyBtn').addEventListener('click', async () => {
            const rawContent = document.getElementById('codeContent').dataset.rawContent;
            if (!rawContent) return;
            
            const success = await copyToClipboard(rawContent);
            const btn = document.getElementById('copyBtn');
            const originalText = btn.textContent;
            
            if (success) {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            } else {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
            }
        });

        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // åˆå§‹åŒ–ä¾§è¾¹æ å®½åº¦è°ƒæ•´åŠŸèƒ½
        function initResizer() {
            const resizer = document.getElementById('resizer');
            const sidebar = document.getElementById('sidebar');
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            // ä»localStorageæ¢å¤å®½åº¦
            const savedWidth = localStorage.getItem('sidebarWidth');
            if (savedWidth) {
                sidebar.style.width = savedWidth + 'px';
            }

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = sidebar.offsetWidth;
                resizer.classList.add('dragging');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                
                const diff = e.clientX - startX;
                const newWidth = startWidth + diff;
                const minWidth = 150;
                const maxWidth = window.innerWidth * 0.5; // æœ€å¤§ä¸è¶…è¿‡50%
                
                if (newWidth >= minWidth && newWidth <= maxWidth) {
                    sidebar.style.width = newWidth + 'px';
                }
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    resizer.classList.remove('dragging');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    // ä¿å­˜å®½åº¦åˆ°localStorage
                    localStorage.setItem('sidebarWidth', sidebar.offsetWidth);
                }
            });
        }

        // åˆå§‹åŒ–ç§»åŠ¨ç«¯ä¾§è¾¹æ æ§åˆ¶
        function initMobileSidebar() {
            const menuBtn = document.getElementById('menuBtn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            // æ‰“å¼€ä¾§è¾¹æ 
            function openSidebar() {
                sidebar.classList.add('mobile-open');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            // å…³é—­ä¾§è¾¹æ 
            function closeSidebar() {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            // èœå•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            if (menuBtn) {
                menuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openSidebar();
                });
            }
            
            // è¦†ç›–å±‚ç‚¹å‡»å…³é—­
            if (overlay) {
                overlay.addEventListener('click', () => {
                    closeSidebar();
                });
            }
            
            // ç‚¹å‡»ä¾§è¾¹æ å†…çš„æ–‡ä»¶æ—¶å…³é—­ä¾§è¾¹æ ï¼ˆç§»åŠ¨ç«¯ï¼‰
            const fileTree = document.getElementById('fileTree');
            if (fileTree) {
                fileTree.addEventListener('click', (e) => {
                    const treeItem = e.target.closest('.tree-item');
                    if (treeItem && treeItem.getAttribute('data-type') === 'file') {
                        // å»¶è¿Ÿå…³é—­ï¼Œè®©æ–‡ä»¶åŠ è½½åŠ¨ç”»å…ˆæ˜¾ç¤º
                        setTimeout(() => {
                            if (window.innerWidth <= 768) {
                                closeSidebar();
                            }
                        }, 100);
                    }
                });
            }
        }

        // åˆå§‹åŒ–å­—ä½“å¤§å°è°ƒæ•´åŠŸèƒ½
        function initFontSizeControl() {
            const fontSizeDecrease = document.getElementById('fontSizeDecrease');
            const fontSizeIncrease = document.getElementById('fontSizeIncrease');
            
            // å‡å°å­—ä½“
            if (fontSizeDecrease) {
                fontSizeDecrease.addEventListener('click', () => {
                    applyFontSize(currentFontSize - fontSizeStep);
                });
            }
            
            // å¢å¤§å­—ä½“
            if (fontSizeIncrease) {
                fontSizeIncrease.addEventListener('click', () => {
                    applyFontSize(currentFontSize + fontSizeStep);
                });
            }
            
            // åˆå§‹åŒ–å­—ä½“å¤§å°
            applyFontSize(currentFontSize);
        }

        // åˆå§‹åŒ–åˆ·æ–°åŠŸèƒ½
        function initRefresh() {
            const refreshBtn = document.getElementById('refreshBtn');
            
            if (!refreshBtn) return;
            
            refreshBtn.addEventListener('click', async () => {
                // é˜²æ­¢é‡å¤ç‚¹å‡»
                if (refreshBtn.classList.contains('refreshing')) {
                    return;
                }
                
                refreshBtn.classList.add('refreshing');
                refreshBtn.disabled = true;
                
                try {
                    if (currentFile) {
                        // å¦‚æœæœ‰å½“å‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œåˆ·æ–°å½“å‰æ–‡ä»¶
                        await loadFile(currentFile);
                    } else {
                        // å¦‚æœæ²¡æœ‰æ‰“å¼€æ–‡ä»¶ï¼Œåˆ·æ–°ç›®å½•æ ‘
                        await loadFileTree();
                    }
                } catch (error) {
                    console.error('åˆ·æ–°å¤±è´¥:', error);
                } finally {
                    // å»¶è¿Ÿç§»é™¤åˆ·æ–°çŠ¶æ€ï¼Œè®©ç”¨æˆ·çœ‹åˆ°åŠ¨ç”»
                    setTimeout(() => {
                        refreshBtn.classList.remove('refreshing');
                        refreshBtn.disabled = false;
                    }, 500);
                }
            });
        }

        // åˆå§‹åŒ–å…³é—­æ–‡ä»¶åŠŸèƒ½
        function initCloseFile() {
            const closeBtn = document.getElementById('closeBtn');
            const dropdownClose = document.getElementById('dropdownClose');
            
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    closeFile();
                    closeDropdown();
                });
            }
            
            if (dropdownClose) {
                dropdownClose.addEventListener('click', () => {
                    closeFile();
                    closeDropdown();
                });
            }
        }

        // åˆå§‹åŒ–ä¸‹æ‹‰èœå•åŠŸèƒ½
        function initDropdownMenu() {
            const dropdownBtn = document.getElementById('dropdownBtn');
            const dropdownContent = document.getElementById('dropdownContent');
            const dropdownCopy = document.getElementById('dropdownCopy');
            const dropdownFontDecrease = document.getElementById('dropdownFontDecrease');
            const dropdownFontIncrease = document.getElementById('dropdownFontIncrease');
            
            if (!dropdownBtn || !dropdownContent) return;
            
            // åˆ‡æ¢ä¸‹æ‹‰èœå•æ˜¾ç¤º
            dropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdownContent.classList.toggle('show');
            });
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', (e) => {
                if (!dropdownContent.contains(e.target) && e.target !== dropdownBtn) {
                    closeDropdown();
                }
            });
            
            // å¤åˆ¶æŒ‰é’®
            if (dropdownCopy) {
                dropdownCopy.addEventListener('click', async () => {
                    const rawContent = document.getElementById('codeContent').dataset.rawContent;
                    if (!rawContent) return;
                    
                    const success = await copyToClipboard(rawContent);
                    
                    if (success) {
                        dropdownCopy.textContent = 'å·²å¤åˆ¶!';
                        setTimeout(() => {
                            dropdownCopy.textContent = 'å¤åˆ¶ä»£ç ';
                        }, 2000);
                    } else {
                        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
                    }
                    
                    closeDropdown();
                });
            }
            
            // å­—ä½“å¤§å°æ§åˆ¶
            if (dropdownFontDecrease) {
                dropdownFontDecrease.addEventListener('click', () => {
                    applyFontSize(currentFontSize - fontSizeStep);
                });
            }
            
            if (dropdownFontIncrease) {
                dropdownFontIncrease.addEventListener('click', () => {
                    applyFontSize(currentFontSize + fontSizeStep);
                });
            }
            
            // åˆå§‹æ›´æ–°ä¸‹æ‹‰èœå•ä¸­å­—ä½“æŒ‰é’®çš„çŠ¶æ€
            const dropdownFontDecreaseEl = document.getElementById('dropdownFontDecrease');
            const dropdownFontIncreaseEl = document.getElementById('dropdownFontIncrease');
            if (dropdownFontDecreaseEl) {
                dropdownFontDecreaseEl.disabled = (currentFontSize <= minFontSize);
                dropdownFontDecreaseEl.classList.toggle('disabled', currentFontSize <= minFontSize);
            }
            if (dropdownFontIncreaseEl) {
                dropdownFontIncreaseEl.disabled = (currentFontSize >= maxFontSize);
                dropdownFontIncreaseEl.classList.toggle('disabled', currentFontSize >= maxFontSize);
            }
        }
        
        // å…³é—­ä¸‹æ‹‰èœå•
        function closeDropdown() {
            const dropdownContent = document.getElementById('dropdownContent');
            if (dropdownContent) {
                dropdownContent.classList.remove('show');
            }
        }
        
        // æ›´æ–°ä¸‹æ‹‰èœå•æ˜¾ç¤ºçŠ¶æ€
        function updateDropdownMenuVisibility() {
            const dropdownMenu = document.getElementById('dropdownMenu');
            const fontSizeControls = document.getElementById('fontSizeControls');
            const copyBtn = document.getElementById('copyBtn');
            
            if (!dropdownMenu) return;
            
            // å¦‚æœæœ‰æ–‡ä»¶æ‰“å¼€ï¼Œæ˜¾ç¤ºä¸‹æ‹‰èœå•ï¼ˆç§»åŠ¨ç«¯ï¼‰æˆ–åŸå§‹æŒ‰é’®ï¼ˆæ¡Œé¢ç«¯ï¼‰
            if (currentFile) {
                if (window.innerWidth <= 768) {
                    // ç§»åŠ¨ç«¯ï¼šæ˜¾ç¤ºä¸‹æ‹‰èœå•
                    dropdownMenu.style.display = 'block';
                } else {
                    // æ¡Œé¢ç«¯ï¼šéšè—ä¸‹æ‹‰èœå•ï¼Œæ˜¾ç¤ºåŸå§‹æŒ‰é’®
                    dropdownMenu.style.display = 'none';
                }
            } else {
                // æ²¡æœ‰æ–‡ä»¶æ‰“å¼€æ—¶éšè—ä¸‹æ‹‰èœå•
                dropdownMenu.style.display = 'none';
            }
        }

        // åˆå§‹åŒ–ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function initThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            
            if (!themeToggle) return;
            
            // ä»localStorageè¯»å–ä¿å­˜çš„ä¸»é¢˜
            const savedTheme = localStorage.getItem('theme');
            const isLightTheme = savedTheme === 'light';
            
            // è®¾ç½®åˆå§‹ä¸»é¢˜
            if (isLightTheme) {
                body.classList.add('light-theme');
                themeToggle.checked = true;
            } else {
                body.classList.remove('light-theme');
                themeToggle.checked = false;
            }
            
            // ç›‘å¬ä¸»é¢˜åˆ‡æ¢
            themeToggle.addEventListener('change', (e) => {
                if (e.target.checked) {
                    body.classList.add('light-theme');
                    localStorage.setItem('theme', 'light');
                } else {
                    body.classList.remove('light-theme');
                    localStorage.setItem('theme', 'dark');
                }
            });
        }

        // åˆå§‹åŒ–
        initResizer();
        initMobileSidebar();
        initFontSizeControl();
        initRefresh();
        initCloseFile();
        initThemeToggle();
        initDropdownMenu();
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œæ›´æ–°ä¸‹æ‹‰èœå•æ˜¾ç¤ºçŠ¶æ€
        window.addEventListener('resize', () => {
            updateDropdownMenuVisibility();
        });
        
        loadFileTree();
    </script>
</body>
</html>

